/**
 * Created by xray on 2015-11-14.
 */
var egret;
(function (e) {
    var t;
    (function (e) {
        var t = function () {
            function e() {
                var e = this;
                this.events = {};
                this.on = function (t, n) {
                    if (!(t in e.events))e.events[t] = [];
                    e.events[t].push(n);
                    return e
                };
                this.trigger = function (t, n) {
                    var r = e.events[t];
                    if (!r)return;
                    for (var o = 0; o < r.length; o++) {
                        if (typeof r[o] == "function") {
                            r[o](n)
                        }
                    }
                }
            }

            e.prototype.removeAllEvents = function () {
                this.events = {}
            };
            return e
        }();
        e.EventBase = t
    })(t = e.devtool || (e.devtool = {}))
})(egret || (egret = {}));
var __extends = this.__extends || function (e, t) {
        for (var n in t)if (t.hasOwnProperty(n))e[n] = t[n];
        function r() {
            this.constructor = e
        }

        r.prototype = t.prototype;
        e.prototype = new r
    };
var egret;
(function (e) {
    var t;
    (function (e) {
        var t = function () {
            function e() {
            }

            e.after = function (t, n, r) {
                if (e.funcs[n])return;
                e.funcs[n] = window.setTimeout(function () {
                    e.funcs[n] = null;
                    r()
                }, t)
            };
            e.funcs = {};
            return e
        }();
        e.RunIt = t;
        var n = function (e) {
            __extends(t, e);
            function t(t) {
                var n = this;
                e.call(this);
                this.el = t;
                this.lastX = 0;
                this.lastY = 0;
                this.isMouseDown = false;
                this.monitorY = true;
                this.begin = function (e) {
                    if (n.isMouseDown)return;
                    n.lastX = e.screenX;
                    n.lastY = e.screenY;
                    n.isMouseDown = true;
                    document.documentElement.addEventListener("mousemove", n.move);
                    document.documentElement.addEventListener("mouseup", n.end);
                    document.body.style["-webkit-user-select"] = "none"
                };
                this.move = function (e) {
                    if (n.isMouseDown == false)return;
                    var t = e.screenY - n.lastY;
                    var r = e.screenX - n.lastX;
                    if (n.monitorY) {
                        n.el.css({transform: "translateY(" + t + "px)"})
                    } else {
                        n.el.css({transform: "translateX(" + r + "px)"})
                    }
                };
                this.end = function (e) {
                    n.isMouseDown = false;
                    document.documentElement.removeEventListener("mousemove", n.move);
                    document.documentElement.removeEventListener("mouseup", n.end);
                    document.body.style["-webkit-user-select"] = "";
                    var t = e.screenY - n.lastY;
                    var r = e.screenX - n.lastX;
                    n.trigger("move", n.monitorY ? t : r);
                    n.el.css({transform: ""})
                };
                window.addEventListener("resize", function () {
                    n.trigger("move", 0)
                });
                t.mousedown(this.begin)
            }

            return t
        }(e.EventBase);
        e.PanelHandle = n;
        var r = function () {
            function e() {
                var e = this;
                this.controlHeight = 30;
                this.nodesHeight = 300;
                this.propsHeight = 300;
                this.nodesWidth = 300;
                this.propsWidth = 300;
                this.width = 300;
                window.addEventListener("resize", function () {
                    e.resize(0, 0)
                });
                this.resize(0, 0)
            }

            e.prototype.resize = function (e, t) {
                var n = window.innerHeight;
                var r = window.innerWidth;
                this.nodesHeight = this.propsHeight = n;
                this.propsWidth -= e;
                this.nodesWidth = r - this.propsWidth - 10
            };
            e.prototype.setWidth = function (e) {
                this.width -= e
            };
            return e
        }();
        e.Layout = r;
        function o(e) {
            var t = {};
            if (!e)return t;
            if (e.indexOf("?") == 0)e = e.substr(1);
            var n = e.split("&");
            n.forEach(function (e) {
                if (e == "?")return;
                if (!e)return;
                var n = e.split("=");
                t[n[0]] = n.length > 1 ? n[1] : null
            });
            return t
        }

        e.parseParam = o
    })(t = e.devtool || (e.devtool = {}))
})(egret || (egret = {}));
var __extends = this.__extends || function (e, t) {
        for (var n in t)if (t.hasOwnProperty(n))e[n] = t[n];
        function r() {
            this.constructor = e
        }

        r.prototype = t.prototype;
        e.prototype = new r
    };
var egret;
(function (e) {
    var t;
    (function (t) {
        var n = function (t) {
            __extends(n, t);
            function n() {
                t.apply(this, arguments);
                this._children = [];
                this._props = [];
                this.parentHash = -1;
                this.show = false;
                this.visible = true;
                this.type = null;
                this.memberName = null;
                this.selected = false;
                this.expandable = false;
                this.isGetter = false;
                this.isSetter = false;
                this.icon = "-";
                this.dirty = false;
                this.hasChildren = false
            }

            n.prototype.updateIcon = function () {
                this.icon = this.hasChildren == false ? "&nbsp;" : this.show ? "-" : "+"
            };
            n.prototype.recover = function () {
                if (this.show && this.hasChildren && (this.children != this._children || this.props != this._props)) {
                    this.children = null;
                    this.props = null;
                    this.showChildren()
                }
            };
            n.prototype.showChildren = function () {
                if (!this.hasChildren)return;
                this.show = true;
                if (!this.children) {
                    this.children = this._children;
                    this.props = this._props;
                    this.trigger(n.ChildrenChange)
                }
                this.updateIcon();
                this.trigger(n.Show)
            };
            n.prototype.toggle = function () {
                if (!this.children && !this.show) {
                    this.showChildren();
                    return
                }
                this.show = !this.show;
                this.updateIcon();
                this.trigger(n.Show)
            };
            n.prototype.parseChildren = function () {
                n.parseChildren(this.raw, this);
                n.parseProps(this.raw, this)
            };
            n.prototype.reset = function (e) {
                if (e === void 0) {
                    e = true
                }
                this._children.forEach(function (e) {
                    return e.reset()
                });
                this._props.forEach(function (e) {
                    return e.reset()
                });
                this._children = [];
                this._props = [];
                this.children = null;
                this.props = null;
                this.show = false;
                if (e) {
                    n.hash2Node[this.rawHash] = undefined;
                    n.hash2DisplayObject[this.rawHash] = undefined
                }
            };
            Object.defineProperty(n.prototype, "raw", {
                get: function () {
                    return n.hash2DisplayObject[this.rawHash]
                }, enumerable: true, configurable: true
            });
            Object.defineProperty(n.prototype, "parent", {
                get: function () {
                    if (this.parentHash == -1)return null;
                    return n.hash2Node[this.parentHash]
                }, enumerable: true, configurable: true
            });
            n.getValue = function (e, t) {
                if (e == null)return String(e);
                var n = typeof e;
                var r = null;
                t.type = n;
                switch (n) {
                    case"string":
                        r = JSON.stringify(e);
                        break;
                    case"number":
                        if (e == NaN)e = "NaN";
                        r = e;
                        return r;
                    case"array":
                        r = String(e);
                        t.expandable = true;
                        break;
                    case"object":
                        r = e.constructor["name"] || e["__class__"] || "object";
                        t.expandable = true;
                        break;
                    case"function":
                        r = String(e);
                        t.name;
                        break;
                    default:
                        r = String(e)
                }
                return r
            };
            n.prototype.naviToDisplayObject = function (e) {
                if (!n.isLinked(e)) {
                    n.linkToIt(e);
                    this.dirty = true
                }
                this.naviToNode(e.hashCode)
            };
            n.prototype.naviToNode = function (e, t) {
                if (t === void 0) {
                    t = false
                }
                var r = n.getByHash(e);
                var o = [];
                var i = r.parent;
                while (i != null) {
                    o.push(i);
                    i = i.parent
                }
                for (var s = o.length - 1; s >= 0; s--)o[s].showChildren();
                r.showUp()
            };
            n.prototype.showUp = function () {
                if (n.selected) {
                    n.selected.selected = false;
                    n.selected.trigger(n.UnSelected)
                }
                this.selected = true;
                n.selected = this;
                this.trigger(n.OnSelected)
            };
            n.prototype.find = function (e, t) {
                if (this.rawHash == e) {
                    t.push(this);
                    return true
                }
                if (!this.hasChildren)return false;
                t.push(this);
                var n = this._props.filter(function (n) {
                    return n.find(e, t)
                });
                var r = n.length > 0;
                if (!r) {
                    n = this._children.filter(function (n) {
                        return n.find(e, t)
                    });
                    r = n.length > 0
                }
                if (!r) {
                    t.pop();
                    return false
                }
                return true
            };
            n.prototype.parseRawProps = function (e, t, r) {
                if (t === void 0) {
                    t = new n
                }
                return n.parseRawProps(this.raw, e, t, r)
            };
            n.parseRawProps = function (t, r, o, i) {
                if (o === void 0) {
                    o = new n
                }
                if (i === void 0) {
                    i = {showPrivate: true, showMethods: false}
                }
                if (r < 0)return;
                if (typeof t != "object")return;
                var s = [];
                for (var a in t) {
                    if (i.showPrivate === false && String(a).indexOf("_") == 0) {
                        continue
                    }
                    var h = new n;
                    h.name = a;
                    var l = null;
                    var u = null;
                    var c = t;
                    u = Object.getOwnPropertyDescriptor(t, a);
                    while (u == null && c) {
                        c = Object.getPrototypeOf(c);
                        u = Object.getOwnPropertyDescriptor(c, a)
                    }
                    if (u) {
                        h.isGetter = u.get != undefined;
                        h.isSetter = h.isGetter && u.set != undefined
                    }
                    try {
                        l = t[a]
                    } catch (d) {
                        l = "faild to get value"
                    }
                    if (typeof l == "function" && i.showMethods != true)continue;
                    n.parseRawProps(l, r - 1, h);
                    h.value = n.getValue(l, h);
                    s.push(h)
                }
                s.sort(function (e, t) {
                    var n = e.name;
                    var r = t.name;
                    return n > r ? 1 : n == r ? 0 : -1
                });
                o.name = e.getQualifiedClassName(t);
                o._props = s;
                return o
            };
            n.parseRawProp = function (e, t, r, o) {
                if (o === void 0) {
                    o = new n
                }
                o.name = e;
                n.parseRawProps(t, r - 1, o);
                o.value = n.getValue(t, o);
                return o
            };
            n.prototype.toString = function () {
                return this.name
            };
            n.linkToIt = function (e, t) {
                if (t === void 0) {
                    t = null
                }
                var r = n.hash2Node[e.hashCode];
                var o = r != undefined;
                if (o) {
                    r.reset(false);
                    n.parseChildren(e, r, 0);
                    n.parseProps(e, r)
                } else {
                    r = n.parseNode(e)
                }
                r.showChildren();
                if (t) {
                    for (var i = 0; i < r._children.length; i++) {
                        if (r._children[i].rawHash == t.rawHash)r._children[i] = t
                    }
                }
                if (o || !e.parent)return r;
                return n.linkToIt(e.parent, r)
            };
            n.unLinkIt = function (e) {
                var t = n.hash2Node[e.hashCode];
                var r = t.parent;
                var o = r._children.indexOf(t);
                r._children.splice(o, 1)
            };
            n.isLinked = function (e) {
                return n.hash2Node[e.hashCode] != undefined
            };
            n.parseChildren = function (t, r, o) {
                if (o === void 0) {
                    o = 0
                }
                if (t instanceof e.DisplayObjectContainer) {
                    var i = t;
                    if (!i._children || i._children.length == 0) {
                        r.hasChildren = false;
                        return
                    } else r.hasChildren = true;
                    r._children = t._children.map(function (e) {
                        var t = n.parseNode(e, new n, false, o);
                        return t
                    })
                }
            };
            n.parseProps = function (t, r) {
                return;
                var o = Object.getOwnPropertyNames(t).sort(function (e, t) {
                    return e > t ? 1 : e == t ? 0 : -1
                });
                for (var i = 0; i < o.length; i++) {
                    var s = o[i];
                    if (s in n.ignore)continue;
                    var a = t[s];
                    if (a instanceof e.DisplayObject) {
                        var h = n.hash2Node[a.hashCode];
                        if (h) {
                            h.memberName = s
                        } else {
                            var l = n.parseNode(a);
                            l.memberName = s;
                            l.parentHash = r.rawHash;
                            r._props.push(l)
                        }
                    }
                }
            };
            n.parseNode = function (t, r, o, i) {
                if (r === void 0) {
                    r = new n
                }
                if (o === void 0) {
                    o = false
                }
                if (i === void 0) {
                    i = 1
                }
                if (i < 0)return null;
                if (o) {
                    n.clear()
                }
                n.hash2Node[t.hashCode] = r;
                n.hash2DisplayObject[t.hashCode] = t;
                var s = e.getQualifiedClassName(t);
                r.name = s;
                r.memberName = t.name;
                r.type = s;
                r.visible = t.visible && t.alpha != 0;
                r.rawHash = t.hashCode;
                r.hasChildren = t instanceof e.DisplayObjectContainer && t._children && t._children.length > 0;
                if (t._parent)r.parentHash = t._parent.hashCode;
                if (i > 0) {
                    n.parseChildren(t, r, i - 1);
                    n.parseProps(t, r)
                }
                r.updateIcon();
                return r
            };
            n.parseRawObject = function (e, t) {
                if (t === void 0) {
                    t = new n
                }
                return n.parseRawProps(e, 0, t)
            };
            n.getByHash = function (e) {
                return n.hash2Node[e]
            };
            n.clear = function () {
                n.hash2Node = {};
                n.hash2DisplayObject = {}
            };
            n.clone = function (e, t, r) {
                if (t === void 0) {
                    t = false
                }
                r = r || new n;
                var o = Object.getOwnPropertyNames(e);
                o.forEach(function (t) {
                    if (t == "events" || t == "_children" || t == "_props")return;
                    r[t] = e[t]
                });
                n.hash2Node[r.rawHash] = r;
                if (e._children.length > 0)r._children = e._children.map(function (e) {
                    return n.clone(e, false, n.getByHash(e.rawHash))
                });
                r.recover();
                t && r.trigger(n.Changed);
                return r
            };
            n.Show = "show";
            n.UnSelected = "unselected";
            n.OnSelected = "selected";
            n.ChildrenChange = "childrenchange";
            n.Changed = "changed";
            n.hash2Node = {};
            n.hash2DisplayObject = {};
            n.ignore = {
                _parent: 1,
                parent: 1,
                _stage: 1,
                stage: 1,
                _eventTarget: 1,
                _children: 1,
                _owner: 1,
                _rendererOwner: 1
            };
            n.selected = null;
            return n
        }(t.EventBase);
        t.TreeNode = n;
        var r = function () {
            function e() {
                this.dirtyCount = [];
                this.dirtyKey = {};
                this.init = false
            }

            e.prototype.push = function (e) {
                while (e != null) {
                    if (e.hashCode in this.dirtyKey) {
                        this.dirtyCount[this.dirtyKey[e.hashCode]] += 1;
                        break
                    } else if (this.init == false) {
                        var t = 0;
                        if (this.dirtyCount.length == 0)t = 1;
                        this.dirtyCount.push(t);
                        this.dirtyKey[e.hashCode] = this.dirtyCount.length - 1
                    }
                    e = e.parent
                }
                this.init = true
            };
            e.prototype.getRootHash = function () {
                for (var e = this.dirtyCount.length; e >= 0; e--) {
                    if (this.dirtyCount[e] > 0) {
                        break
                    }
                }
                for (var t in this.dirtyKey) {
                    if (this.dirtyKey[t] == e)return t
                }
            };
            e.prototype.reset = function () {
                this.dirtyCount = [];
                this.dirtyKey = {};
                this.init = false
            };
            return e
        }();
        t.TreeDirtyCache = r
    })(t = e.devtool || (e.devtool = {}))
})(egret || (egret = {}));
var EGRETRELEASE = true;
var egret;
(function (e) {
    var t;
    (function (e) {
        var t = function () {
            function e(e, t) {
                this.host = e;
                this.callbacks = {};
                this.namedCallbacks = {};
                this.key = null;
                this.getKey();
                this._connect(t)
            }

            e.prototype._connect = function (e) {
            };
            e.prototype.post = function (e, t, n) {
                if (t === void 0) {
                    t = null
                }
                var r = t;
                if (n) {
                    r = (performance.now() + Math.random() * 100).toString();
                    this.callbacks[r] = n
                }
                var o = {id: r, data: e, key: this.key};
                this._doPost(o);
                return this
            };
            e.prototype._doPost = function (e) {
                this.port.postMessage(e)
            };
            e.prototype.on = function (e, t) {
                if (!this.namedCallbacks[e])this.namedCallbacks[e] = [];
                this.namedCallbacks[e].push(t);
                return this
            };
            e.prototype.remove = function (e, t) {
                var n = this.namedCallbacks[e];
                if (n) {
                    var r = n.indexOf(t);
                    if (r < 0)return;
                    n.splice(r, 1)
                }
                return this
            };
            e.prototype._parseMsgData = function (e) {
                return null
            };
            e.prototype._onMessage = function (e) {
                var t = this;
                var n = this._parseMsgData(e);
                var r = n.id;
                var o = n.data.name;
                var i = this.callbacks[r];
                if (i) {
                    i(n.data);
                    delete this.callbacks[r]
                }
                var s = this.namedCallbacks[o];
                if (s) {
                    s.forEach(function (e) {
                        var o = e(n.data, function (e) {
                            if (r) {
                                t.post(e, r)
                            }
                        });
                        if (r && o) {
                            t.post(o, r)
                        }
                    })
                }
            };
            e.prototype.getKey = function () {
                if (window.name == "") {
                    window.name = Date.now().toString()
                }
                this.key = window.name
            };
            return e
        }();
        e.PortBase = t
    })(t = e.devtool || (e.devtool = {}))
})(egret || (egret = {}));
var __extends = this.__extends || function (e, t) {
        for (var n in t)if (t.hasOwnProperty(n))e[n] = t[n];
        function r() {
            this.constructor = e
        }

        r.prototype = t.prototype;
        e.prototype = new r
    };
var egret;
(function (e) {
    var t;
    (function (e) {
        var t = function (e) {
            __extends(t, e);
            function t() {
                e.apply(this, arguments)
            }

            t.prototype._connect = function (e) {
                var t = this;
                var n = chrome.runtime.connect();
                n.onMessage.addListener(function (e) {
                    return t._onMessage(e)
                });
                this.port = n;
                e && window.setTimeout(e.bind(this), 0)
            };
            t.prototype._doPost = function (e) {
                this.port.postMessage(e)
            };
            t.prototype._parseMsgData = function (e) {
                return e
            };
            return t
        }(e.PortBase);
        e.ChromePort = t;
        var n = function (e) {
            __extends(t, e);
            function t() {
                e.apply(this, arguments)
            }

            t.prototype._connect = function (e) {
                var t = this;
                var n = chrome.runtime.connect();
                n.onMessage.addListener(function (e) {
                    return t._onMessage(e)
                });
                this.port = n;
                window.addEventListener("message", function (e) {
                    return t._onWindowMessage(e.data)
                });
                e && window.setTimeout(e.bind(this), 0)
            };
            t.prototype._doPost = function (e) {
                this.port.postMessage(e)
            };
            t.prototype._parseMsgData = function (e) {
                return e
            };
            t.prototype._onMessage = function (t) {
                if (t.toContent) {
                    e.prototype._onMessage.call(this, t)
                } else {
                    window.postMessage(t, "*")
                }
            };
            t.prototype._onWindowMessage = function (e) {
                if (e["from"] == "stage") {
                    var t = JSON.parse(e.data);
                    this.post(t, e.id)
                }
            };
            return t
        }(e.PortBase);
        e.ContentPort = n;
        var r = function (e) {
            __extends(t, e);
            function t() {
                e.apply(this, arguments)
            }

            t.prototype._connect = function (e) {
                var t = this;
                window.addEventListener("message", function (e) {
                    return t._onMessage(e)
                });
                e && window.setTimeout(e.bind(this), 0)
            };
            t.prototype._doPost = function (e) {
                window.postMessage({from: "stage", id: e.id, data: JSON.stringify(e.data)}, "*")
            };
            t.prototype._parseMsgData = function (e) {
                return e.data
            };
            t.prototype._onMessage = function (t) {
                var n = this._parseMsgData(t);
                if (n["from"] == "stage")return false;
                e.prototype._onMessage.call(this, t)
            };
            return t
        }(e.PortBase);
        e.StagePort = r;
        var o = function (e) {
            __extends(t, e);
            function t() {
                e.apply(this, arguments)
            }

            t.prototype._connect = function (e) {
                var t = this;
                var n = new WebSocket("ws://" + this.host);
                this.port = n;
                n.addEventListener("message", function (e) {
                    return t._onMessage(e)
                });
                n.addEventListener("open", function (n) {
                    return e(t)
                })
            };
            t.prototype._doPost = function (e) {
                var t = this.port;
                t.send(JSON.stringify(e))
            };
            t.prototype._parseMsgData = function (e) {
                return JSON.parse(e.data)
            };
            return t
        }(e.PortBase);
        e.WsPort = o
    })(t = e.devtool || (e.devtool = {}))
})(egret || (egret = {}));
var egret;
(function (e) {
    var t;
    (function (e) {
        e.PortFactory = null
    })(t = e.devtool || (e.devtool = {}))
})(egret || (egret = {}));
var egret;
(function (e) {
    var t;
    (function (t) {
        var n = function () {
            function t() {
            }

            t.prototype.getStagePortClass = function () {
                return e.devtool.StagePort
            };
            t.prototype.getPanelPortClass = function () {
                return e.devtool.ChromePort
            };
            t.prototype.getExtContentPortClass = function () {
                return e.devtool.ContentPort
            };
            return t
        }();
        t.ChromePortFactory = n;
        t.PortFactory = new n
    })(t = e.devtool || (e.devtool = {}))
})(egret || (egret = {}));
var __extends = this.__extends || function (e, t) {
        for (var n in t)if (t.hasOwnProperty(n))e[n] = t[n];
        function r() {
            this.constructor = e
        }

        r.prototype = t.prototype;
        e.prototype = new r
    };
var egret;
(function (e) {
    var t;
    (function (t) {
        var n = "devtool_showSelected";
        var r = "devtool_showHover";
        var o = "#00AA00";
        var i = "rgba(79, 169, 144, 0.13)";
        var s = "#AA0000";
        var a = "rgba(169, 0, 0, 0.5)";
        var h = "rgba(79, 92, 169, 0.88)";
        var l = "rgba(79, 92, 169, 0.13)";
        var u = function (t) {
            __extends(n, t);
            function n() {
                t.apply(this, arguments);
                this._tick = 0;
                this._totalDeltaTime = 0
            }

            n.prototype.run = function () {
                e.Ticker.getInstance().register(this.update, this)
            };
            n.prototype.update = function (e) {
                this._tick++;
                this._totalDeltaTime += e;
                if (this._totalDeltaTime >= n._maxDeltaTime) {
                    var t = Math.floor(this._tick * 1e3 / this._totalDeltaTime);
                    this.trigger("fps", t);
                    this._totalDeltaTime = 0;
                    this._tick = 0
                }
            };
            n.instance = null;
            n._maxDeltaTime = 500;
            return n
        }(e.devtool.EventBase);
        t.Profiler = u;
        var c = function () {
            function t() {
            }

            t.checkContainer = function (n, r, o) {
                var i;
                if (!n._visible) {
                    return null
                }
                if (n._scrollRect) {
                    if (r < n._scrollRect.x || o < n._scrollRect.y || r > n._scrollRect.x + n._scrollRect.width || o > n._scrollRect.y + n._scrollRect.height) {
                        return null
                    }
                } else if (n.mask) {
                    if (n.mask.x > r || r > n.mask.x + n.mask.width || n.mask.y > o || o > n.mask.y + n.mask.height) {
                        return null
                    }
                }
                var s = n._children;
                var a = s.length;
                var h = n._touchChildren;
                for (var l = a - 1; l >= 0; l--) {
                    var u = s[l];
                    var c = u._getMatrix();
                    var d = u._scrollRect;
                    if (d) {
                        c.append(1, 0, 0, 1, -d.x, -d.y)
                    }
                    c.invert();
                    var f = e.Matrix.transformCoords(c, r, o);
                    var p = f.x, v = f.y;
                    var g = t.checkDispObject;
                    if (u instanceof e.DisplayObjectContainer)g = t.checkContainer;
                    var w = g(u, p, v);
                    if (w) {
                        if (!h) {
                            return n
                        }
                        return w
                    }
                }
                if (i) {
                    return i
                } else if (n._texture_to_render || n["graphics"]) {
                    return t.checkDispObject(n, r, o)
                }
                return null
            };
            t.checkDispObject = function (t, n, r) {
                if (!t._visible) {
                    return null
                }
                var o = t._getSize(e.Rectangle.identity);
                if (!(0 <= n && n < o.width && 0 <= r && r < o.height)) {
                    return null
                }
                var i = t.mask || t._scrollRect;
                if (!i)return t;
                var s = [t.mask, t._scrollRect];
                var a = s.some(function (e) {
                    return e && n >= e.x && r >= e.y && n <= e.x + e.width && r <= e.y + e.height
                });
                return a ? t : null
            };
            t.find = function (n, r) {
                if (r.hashCode == n || r.name && r.name.indexOf(n) >= 0)return [r];
                var o = r instanceof e.DisplayObjectContainer ? r : null;
                if (o == null)return null;
                if (o._children == null || o._children.length == 0)return null;
                var i = null;
                for (var s = 0; s < o._children.length; s++) {
                    var a = o._children[s];
                    var h = t.find(n, a);
                    if (h) {
                        if (!i)i = h; else i = i.concat(h)
                    }
                }
                return i
            };
            return t
        }();
        t.DisplayObjectLocator = c;
        var d = function (t) {
            __extends(n, t);
            function n() {
                var n = this;
                t.apply(this, arguments);
                this.highlightHover = false;
                this.highlightClick = true;
                this.executeMouseEvents = true;
                this.onMouseMove = function (t) {
                    if (n.highlightHover == false)return;
                    var r = n.translate(t);
                    var o = e.MainContext.instance.stage;
                    var i = c.checkContainer(o, r.x, r.y);
                    if (!i || i == n.hovered || i == e.MainContext.instance.stage)return;
                    n.hovered = i
                };
                this.onMouseOut = function (e, t) {
                    if (t === void 0) {
                        t = false
                    }
                    n.hovered = null
                };
                this.onMouseDown = function (t) {
                    if (n.highlightClick == false)return;
                    var r = n.translate(t);
                    var o = e.MainContext.instance.stage;
                    var i = c.checkContainer(o, r.x, r.y);
                    if (!i || i == n.selected)return;
                    n.selected = i
                }
            }

            Object.defineProperty(n.prototype, "hovered", {
                get: function () {
                    return this._hovered
                }, set: function (e) {
                    if (e == this._hovered)return;
                    this._hovered = e;
                    this.trigger("hovered", e)
                }, enumerable: true, configurable: true
            });
            Object.defineProperty(n.prototype, "selected", {
                get: function () {
                    return this._selected
                }, set: function (e) {
                    if (e == this._selected)return;
                    this._selected = e;
                    if (e)this.trigger("selected", e)
                }, enumerable: true, configurable: true
            });
            n.prototype.init = function () {
                var t = document.getElementById(e.StageDelegate.canvas_div_name);
                this.div = t;
                this.target_div = t;
                this.div.addEventListener("mousedown", this.onMouseDown);
                this.div.addEventListener("mousemove", this.onMouseMove);
                this.div.addEventListener("mouseleave", this.onMouseOut);
                this.div.addEventListener("MSPointerDown", this.onMouseDown, true);
                this.div.addEventListener("MSPointerMove", this.onMouseMove, true);
                this.div.addEventListener("touchstart", this.onMouseDown);
                this.div.addEventListener("touchmove", this.onMouseMove);
                this.div.addEventListener("touchcancel", this.onMouseOut);
                this.divPosition = this.target_div.getBoundingClientRect();
                return this
            };
            n.prototype.reset = function () {
                this.div.removeEventListener("mousedown", this.onMouseDown);
                this.div.removeEventListener("mousemove", this.onMouseMove);
                this.div.removeEventListener("mouseleave", this.onMouseOut)
            };
            n.prototype.translate = function (t) {
                var n = e.HTML5TouchContext.prototype;
                if (t.touches) {
                    t = t.touches[0]
                }
                return n.getLocation(this.target_div, t)
            };
            n.prototype.preventTouch = function (e) {
                this.executeMouseEvents = !e
            };
            return n
        }(e.devtool.EventBase);
        t.Mask = d;
        var f = function (n) {
            __extends(r, n);
            function r() {
                n.apply(this, arguments);
                this.renderCost = {};
                this.lastSelected = null;
                this.lastHovered = null;
                this._rawDraw = null;
                this._mask = null;
                this._antOffset = 0;
                this._preventTouch = false;
                this.performance = window.performance
            }

            r.attach = function (e) {
                if (r.instance == null) {
                    r.instance = new r
                }
                r.instance.attch(e)
            };
            r.show = function (e) {
                r.instance.show(e)
            };
            r.prototype.attch = function (n) {
                var r = this;
                var o = this;
                this._mask = (new d).init();
                this._mask.on("selected", function (e) {
                    return r.show(e)
                });
                this._mask.on("hovered", function (e) {
                    return r.show(e, true)
                });
                var i = t.Profiler.instance || new t.Profiler;
                i.removeAllEvents();
                i.on("fps", function (e) {
                    r.trigger("fps", e)
                });
                n.stage.addEventListener(e.TouchEvent.LEAVE_STAGE, function (e) {
                    return r.lastHovered = null
                }, this);
                n.stage.addEventListener(e.Event.REMOVED, function (e) {
                    var t = e.target;
                    r.trigger("displayObjectRemoved", t)
                }, this);
                var s = n.rendererContext.onRenderFinish;
                n.rendererContext.onRenderFinish = function () {
                    s.call(this);
                    o._drawTarget()
                };
                var a = n.touchContext.onTouchBegan;
                n.touchContext.onTouchBegan = function (e, t, n) {
                    if (o._preventTouch)return;
                    a.call(this, e, t, n)
                };
                t.Profiler.instance = i;
                i.run()
            };
            r.prototype.detach = function (e) {
                this.lastSelected = null;
                this.lastHovered = null;
                this._mask.reset()
            };
            r.prototype.show = function (e, t) {
                if (t === void 0) {
                    t = false
                }
                if (t) {
                    this.lastHovered = e;
                    this._mask._hovered = e
                } else {
                    this.lastSelected = e;
                    this._mask._selected = e
                }
                if (!t)this.trigger("selected", e)
            };
            r.prototype.preventTouch = function (e) {
                this._preventTouch = e;
                this._mask.preventTouch(e)
            };
            r.prototype.update = function () {
            };
            r.prototype._drawTarget = function () {
                this._drawEdge(this.lastSelected, true);
                if (this.lastHovered != this.lastSelected)this._drawEdge(this.lastHovered, false)
            };
            r.prototype._drawRect = function (e, t, n, r) {
                e.fillStyle = r;
                e.beginPath();
                e.fillRect(t.x, t.y, t.width, t.height);
                e.closePath();
                e.beginPath();
                e.strokeStyle = n;
                e.lineWidth = 1;
                e.strokeRect(t.x, t.y, t.width, t.height)
            };
            r.prototype._drawEdge = function (t, n) {
                if (n === void 0) {
                    n = true
                }
                if (t == null)return;
                var r = e.MainContext.instance.rendererContext;
                var s = t.x;
                var a = t.y;
                var u = r.canvasContext;
                var c = u.globalAlpha;
                u.save();
                u.globalAlpha = 1;
                u.setTransform(1, 0, 0, 1, 0, 0);
                var d = t._getMatrix();
                var f = t._worldTransform;
                var p = 0, v = 0;
                var g = {x: 0, y: 0, width: t.width, height: t.height};
                u.setTransform(1, 0, 0, 1, f.tx, f.ty);
                if (n) {
                    u.setLineDash([5]);
                    u.lineDashOffset = this._antOffset / 5
                }
                var w = n ? o : h;
                var y = n ? i : l;
                var _ = t.mask || t.scrollRect;
                if (_) {
                    g.x = _.x;
                    g.y = _.y;
                    g.width = _.width;
                    g.height = _.height;
                    p += _.x;
                    v += _.y
                }
                this._drawRect(u, g, w, y);
                p = p + f.tx < 0 ? -p - f.tx : p;
                v = v + f.ty < 0 ? -v - f.ty : v;
                u.setTransform(1, 0, 0, 1, f.tx, f.ty);
                u.lineDashOffset = 0;
                var m = ["x:", Math.round(s), ",y:", Math.round(a), ",w:", Math.round(g.width), ",h:", Math.round(g.height)].join("");
                u.font = "12px Consolas,Courier New, Courier, monospace";
                u.fillStyle = "#333";
                u.lineWidth = 1;
                u.globalAlpha = .6;
                u.fillRect(p, v, u.measureText(m).width + 10, 16);
                u.fillStyle = "#FFF";
                u.globalAlpha = 1;
                u.fillText(m, p + 5, v + 12);
                u.closePath();
                u.setTransform(1, 0, 0, 1, 0, 0);
                u.restore();
                u.globalAlpha = c;
                if (n) {
                    this._antOffset++;
                    if (this._antOffset > 100)this._antOffset = 0
                }
            };
            r.prototype._rewriteStageEvents = function () {
            };
            r.prototype._rewriteDraw = function () {
                if (e.DisplayObject.prototype["rewrite"])return;
                this._rawDraw = e.DisplayObject.prototype._draw;
                var t = this;
                var n = function (e) {
                    var n = this;
                    var r = t.performance.now();
                    t._rawDraw.call(this, e);
                    var o = t.performance.now();
                    var i = o - r;
                    t.renderCost[n.hashCode] = i
                };
                e.DisplayObject.prototype._draw = n;
                e.DisplayObject.prototype["rewrite"] = true
            };
            Object.defineProperty(r.prototype, "highlightHover", {
                set: function (e) {
                    this._mask.highlightHover = e;
                    if (!e) {
                        this.lastHovered = null;
                        this._mask._hovered = null
                    }
                }, enumerable: true, configurable: true
            });
            Object.defineProperty(r.prototype, "highlightClick", {
                set: function (e) {
                    this._mask.highlightClick = e;
                    if (!e) {
                        this.lastSelected = null;
                        this._mask._selected = null
                    }
                }, enumerable: true, configurable: true
            });
            r.instance = null;
            return r
        }(e.devtool.EventBase);
        t.Inspector = f
    })(t = e.devtool || (e.devtool = {}))
})(egret || (egret = {}));
var egret;
(function (egret) {
    var devtool;
    (function (devtool) {
        var rootDiv;
        var Main = function () {
            function Main() {
                var e = this;
                this.tree = null;
                this.showMethods = false;
                this.showPrivate = true;
                this.treeDirtyCache = new devtool.TreeDirtyCache;
                this.linkAndShow = function (t) {
                    var n = null;
                    if (devtool.TreeNode.isLinked(t) == false) {
                        n = devtool.TreeNode.linkToIt(t)
                    }
                    e.showItInTree(t.hashCode, n)
                };
                this.search = function (t, n) {
                    var r = t.option.name;
                    var o = t.option.current;
                    var i = devtool.DisplayObjectLocator.find(r, egret.MainContext.instance.stage);
                    if (i == null || i.length == 0) {
                        n([]);
                        return
                    }
                    var s = null;
                    if (o) {
                        var a = 0;
                        while (a < i.length) {
                            if (i[a].hashCode == o)break;
                            a++
                        }
                        a++;
                        if (a >= i.length) {
                            a = 0
                        }
                        s = i[a]
                    } else s = i[0];
                    e.linkAndShow(s);
                    e.showTreeSelection(s.hashCode);
                    n({
                        current: s.hashCode, results: i.map(function (e) {
                            return e.hashCode
                        })
                    })
                }
            }

            Main.prototype.init = function () {
                var _this = this;
                window.setTimeout(function () {
                    return _this.refresh()
                }, 200);
                var isp = egret.devtool.Inspector.instance;
                isp.removeAllEvents();
                isp.on("selected", this.linkAndShow).on("fps", function (e) {
                    _this.port.post({name: "fps", data: e})
                });
                isp.preventTouch(Main.preventTouch);
                var port = this.port;
                port.on("showTreeSelection", function (e) {
                    return _this.showTreeSelection(e.data, e.isHover)
                });
                port.on("preventTouch", function (e) {
                    var t = e.data;
                    Main.preventTouch = t;
                    _this.preventTouch(t)
                });
                port.on("highlightHover", function (e) {
                    isp.highlightHover = e.data
                });
                port.on("highlightClick", function (e) {
                    isp.highlightClick = e.data
                });
                port.on("showMethodsChanged", function (e) {
                    _this.showMethods = e.showMethods;
                    e.hash && _this.showItInTree(e.hash)
                });
                port.on("showPrivateChanged", function (e) {
                    _this.showPrivate = e.showPrivate;
                    e.hash && _this.showItInTree(e.hash)
                });
                port.on("initOptions", function (e) {
                    isp.highlightClick = e.highlightClick;
                    isp.highlightHover = e.highlightHover;
                    Main.preventTouch = e.preventTouch;
                    _this.preventTouch(e.preventTouch);
                    _this.showMethods = e.showMethods;
                    _this.showPrivate = e.showPrivate
                });
                port.on("init", function (e) {
                    _this.refresh()
                });
                port.on("expand", function (msg, callback) {
                    var it = devtool.TreeNode.getByHash(msg.hash).raw;
                    var expression = msg.expression;
                    var value = eval("it" + expression);
                    var tree = devtool.TreeNode.parseRawProps(value, 0, new devtool.TreeNode, {
                        showMethods: _this.showMethods,
                        showPrivate: _this.showPrivate
                    });
                    callback(tree)
                });
                var propIdx = 0;
                port.on("store", function (msg) {
                    if (devtool.TreeNode.getByHash(msg.hashCode) == null) {
                        console.log("该显示对象已经不存在，请刷新显示列表");
                        return
                    }
                    var value = devtool.TreeNode.getByHash(msg.hashCode).raw;
                    var varName = "obj" + msg.hashCode;
                    if (msg.expression) {
                        value = eval("value" + msg.expression);
                        varName = "prop" + propIdx++
                    }
                    window[varName] = value;
                    console.log(varName);
                    console.log(value)
                });
                port.on("applyChange", function (msg, callback) {
                    var it = devtool.TreeNode.getByHash(msg.hash).raw;
                    var expression = msg.expression, exps = msg.expressions || {};
                    var result = {};
                    var applyChange = function (exp, value, it) {
                        if (!exp)return undefined;
                        eval("it" + exp + "=eval('(" + value + ")')");
                        return eval("it" + exp)
                    };
                    try {
                        if (expression)result = applyChange(expression, msg.value, it);
                        for (var exp in exps) {
                            result[exp] = applyChange(exp, exps[exp], it)
                        }
                        if (result == NaN)result = "NaN";
                        egret.callLater(function () {
                            return callback({success: true, result: result})
                        }, _this)
                    } catch (e) {
                        console.log(e.stack);
                        callback({success: false})
                    }
                });
                port.on("expandTree", function (e, t) {
                    var n = devtool.TreeNode.getByHash(e.hashCode);
                    n.parseChildren();
                    t(n)
                });
                port.on("refresh", function (e, t) {
                    devtool.TreeNode.clear();
                    var n = isp.lastSelected && isp.lastSelected.stage ? isp.lastSelected : egret.MainContext.instance.stage;
                    var r = devtool.TreeNode.linkToIt(n);
                    t({tree: r, hash: n.hashCode});
                    _this.showItInTree(n.hashCode)
                });
                port.on("refreshProp", function (e) {
                    _this.showItInTree(e.hash, null)
                });
                port.on("search", this.search);
                return this
            };
            Main.prototype.refresh = function () {
                devtool.TreeNode.clear();
                var e = egret.MainContext.instance.stage;
                this.tree = devtool.TreeNode.parseNode(e, new devtool.TreeNode, true, 2);
                this.tree.showChildren();
                this.transTreeToPanel();
                this.showItInTree(e.hashCode)
            };
            Main.prototype.transTreeToPanel = function (e) {
                if (e === void 0) {
                    e = this.tree
                }
                this.port.post({name: "updateTree", data: this.tree})
            };
            Main.prototype.showItInTree = function (e, t) {
                if (t === void 0) {
                    t = null
                }
                var n = devtool.TreeNode.getByHash(e);
                if (!n)return;
                var r = n.parseRawProps(0, new devtool.TreeNode, {
                    showPrivate: this.showPrivate,
                    showMethods: this.showMethods
                });
                this.transGameSelection(n.rawHash, r, t)
            };
            Main.prototype.transGameSelection = function (e, t, n) {
                if (n === void 0) {
                    n = null
                }
                this.port.post({name: "updateSelection", data: {hash: e, props: t, treeChange: n}})
            };
            Main.prototype.showTreeSelection = function (e, t) {
                if (t === void 0) {
                    t = false
                }
                var n = devtool.TreeNode.getByHash(e);
                egret.devtool.Inspector.instance.show(n.raw, t)
            };
            Main.prototype.preventTouch = function (e) {
                egret.devtool.Inspector.instance.preventTouch(e)
            };
            Main.preventTouch = false;
            Main.instance = null;
            return Main
        }();
        devtool.Main = Main;
        function start() {
            var e = function (e) {
                e.post({name: "init", from: "stage", href: location.href});
                e.post({name: "ready"});
                Main.instance.port = e;
                Main.instance.init()
            };
            if (egret.MainContext && egret.MainContext.instance && egret.MainContext.instance.stage) {
                if (egret.devtool.Inspector.instance)return;
                egret.devtool.Inspector.attach(egret.MainContext.instance);
                Main.instance = new Main;
                if (stagePort) {
                    e(stagePort)
                } else {
                    var t = devtool.PortFactory.getStagePortClass();
                    stagePort = new t(location.host, function () {
                        e(port)
                    })
                }
            } else {
                window.setTimeout(start, 200)
            }
        }

        devtool.start = start;
        function reset() {
            if (Main.instance) {
                Main.instance.tree.reset();
                egret.devtool.Inspector.instance.detach(egret.MainContext.instance)
            }
        }

        devtool.reset = reset;
        function pause() {
        }

        devtool.pause = pause;
        function resume() {
        }

        devtool.resume = resume;
        var stagePort = null;

        function ping() {
            var e = devtool.PortFactory.getStagePortClass();
            stagePort = new e(location.host, function () {
                stagePort.post({name: "isDevToolOpen"}, null, function (e) {
                    if (e) {
                        start()
                    }
                })
            })
        }

        devtool.ping = ping;
        ping()
    })(devtool = egret.devtool || (egret.devtool = {}))
})(egret || (egret = {}));